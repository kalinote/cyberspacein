import time
from llama_cpp import Llama

# 1. 加载模型
llm = Llama(
    model_path="./models_bin/Qwen3-4B-Q4_K_M.gguf",
    n_ctx=10240,
    n_threads=16,
    verbose=False
)

def keywords_extract(text):
    json_schema = {
        "type": "object",
        "properties": {
            "keywords": {
                "type": "array",
                "items": {"type": "string"},
                "minItems": 5,   # 最少5个
                "maxItems": 10   # 最多10个
            }
        },
        "required": ["keywords"]
    }
    
    messages = [
        {
            "role": "system",
            "content": "你是一位专业的内容编辑和 SEO 专家。" 
        },
        {
            "role": "user",
            "content": f"/think 请阅读下文，并从中提取 5-10 个关键词。 要求：\n\n关键词必须能概括文章的核心主题。\n\n优先选择专有名词、技术术语或具有代表性的动名词。\n\n排除“文章”、“方法”、“重要性”等无实际意义的泛泛之词。\n\n按重要性从高到低排列。 输出 JSON 格式。\n\n{text}"
        }
    ]
    
    response = llm.create_chat_completion(
        messages=messages,
        max_tokens=2048,
        temperature=0.1,
        response_format={
            "type": "json_object",
            "schema": json_schema
        }
    )
    
    return response["choices"][0]["message"]["content"]

# --- 测试代码 ---
text = """\
2025年四季度，“顶流”基金经理、易方达基金张坤旗下三只基金同步减配多只白酒股。1月22日，张坤在管的4只基金悉数披露2025年四季报。截至2025年12月末，张坤旗下在管总规模已降至约483.83亿元。调仓换股方面，易方达蓝筹精选、易方达优质精选、易方达优质企业三年持有一致减持了贵州茅台、五粮液、泸州老窖、山西汾酒。此外，京东健康、分众传媒、招商银行也遭张坤明显减仓。另在地区配置方面，张坤降低了对于中国香港和美国股票的仓位，同时上调了对韩国及中国台湾地区的配置比例。其中，三星电子跃升为易方达亚洲精选的头号重仓股。在2025年四季报中，张坤提及到了“AI泡沫论”争议。他表示，一个国家有强大的内需市场对科技创新也有重要的促进作用，强大的需求和盈利能力能够虹吸全球的资源、人才和资本为创新服务。“对比来看，我们投资的一家国内企业也拥有国内领先的基础模型能力，如果有更加强劲的消费环境，订阅收入和模型能力投入就能实现更好的互动，有助于未来追近全球领先的模型水平。”张坤称。减仓多只白酒股目前，张坤在管4只公募基金，分别是易方达蓝筹精选、易方达优质精选、易方达优质企业三年持有、易方达亚洲精选。其中规模最大的产品是易方达蓝筹精选，截至2025年四季度末，该基金的资产净值为310.21亿元。从基金业绩情况来看，2025年四季度期间，易方达蓝筹精选大幅跑输同期业绩比较基准。该基金份额净值为1.8623元，2025年四季度基金份额净值增长率为-8.93%，同期业绩比较基准收益率为-2.63%。资产配置方面，易方达蓝筹精选2025年四季度末的股票仓位小幅度提升，为93.64%；而该基金前十大重仓股持股集中度则由86.85%降至85.10%。再看张坤最新的调仓持股动作，易方达蓝筹精选的前十大重仓股并未发生变更，依次为：腾讯控股（00700.HK）、贵州茅台（600519.SH）、五粮液（000858.SZ）、阿里巴巴（09988.HK）、山西汾酒（600809.SH）、泸州老窖（000568.SZ）、百胜中国（09987.HK）、中国海洋石油（00883.HK）、京东健康（06618.HK）、分众传媒（002027.SZ）。其中，张坤较大幅度地减持了京东健康、分众传媒，还减配了泸州老窖、山西汾酒、五粮液；加仓了阿里巴巴。与上述两只基金类似的是，在2025年四季度，张坤旗下的易方达优质精选基金、易方达优质企业三年持有也并未更迭前十大重仓股，仅对部分个股进行了减持操作。具体来看，京东健康、招商银行遭易方达优质企业三年持有较大幅度减持，减仓比例分别为54.10%、31.43%。两只基金还共同减配了五粮液、山西汾酒、泸州老窖、贵州茅台这几只白酒股。易方达亚洲精选是张坤在管基金中规模最小的一只基金，同时也是一只QDII基金。截至2025年四季度末，易方达亚洲精选的资产净值合计为33.92亿元。从该基金的地区配置情况来看，该基金降低了对于中国香港和美国股票的仓位，同时上调了对韩国及中国台湾地区的配置比例。对应到个股调仓方面，张坤较大幅度增持了台湾的台积电（2330.TW)，对于台积电美股（TSM.N）则进行了减持；此外，腾讯控股、阿里巴巴获得了小幅度加仓；富途控股（FUTU.US）则重回持仓前十。另一方面，三星电子（005930.KS）持股数量单季度减少13.18%后，仍然跃升为易方达亚洲精选的头号重仓股，不过由于该股所占基金净值比达9.88%，已接近顶格配置，再叠加2025年四季度区间涨幅来看，或为张坤被动减仓行为。知名奢侈品股普拉达（01913.HK）则退出了持仓前十。主要城市的房价下跌有望进入尾声在2025年四季报中，张坤首先从增量和存量两方面分析了我国未来经济、消费等关键要素的走向。张坤指出，最近几年，从社零、消费者信心指数、CPI等指标来看，国内消费始终处于较弱的状态。在上市公司中，相比主要做出口（即其他国家的消费或投资）企业，以国内需求为主的企业经营压力总体更大一些。如果以芒格说的“在有鱼的地方钓鱼”为标准来看，过去三年中前者更加符合这个标准。“但是长期来看，我们并不认为这是一个常态。”张坤表示。从增量角度，张坤认为，按照国家“十五五”规划，我国目标在2035年人均GDP达到中等发达国家水平。就算不考虑经济增长带来的发达国家门槛提升，2024年我国人均GDP  1.33万美元，要达到这个目标，人均GDP的复合增长率需要达到5.27%，这个增长速度，显然会高于未来几年全球GDP的总体增速。而且，张坤认为，即使我们经济达到（中等发达国家的）目标后，依然可能只是发展的里程碑之一。从存量角度，张坤称，房价在过去5年的显著下跌对居民的财富和资产负债表造成了负面影响，居民的预防性储蓄上升和提前还贷也影响了国内消费需求。他认为，考虑较低的无风险利率水平、潜在可能的政策支持以及新开工面积的下降，主要城市的房价下跌有望进入尾声。过去几年，老百姓创造的增量财富被存量财富下降抵消，进而降低了消费意愿，这种情况未来有望改观。综上，从增量和存量两方面来看，张坤认为，未来十年，不论是老百姓的实际生活水平还是社会保障水平，都会有一个显著的提升，与发达国家的生活水平差距也会明显缩小。在某个时刻，市场会意识到投资需求在国内的公司也是“在有鱼的地方钓鱼”。市场先生的出价使得部分优质公司非常划算在此次季报中，张坤也提及到了“AI泡沫论”争议。从这次AI浪潮来看，张坤称，一个国家有强大的内需市场对科技创新也有重要的促进作用，强大的需求和盈利能力能够虹吸全球的资源、人才和资本为创新服务。以海外领先的模型GPT和Gemini为例，张坤认为，这些已经成了不少投资者做研究的日常必备工具，其C端每年200美金左右的订阅费构成了企业现阶段重要的收入来源之一，在“AI泡沫论”争议的今天，这些实打实的订阅收入对模型企业融资和持续投入的信心起了重要作用。对比来看，张坤认为，他投资的一家国内企业也拥有国内领先的基础模型能力，如果有更加强劲的消费环境，订阅收入和模型能力投入就能实现更好的互动，有助于未来追近全球领先的模型水平。张坤表示，他始终对组合中企业的商业模式、竞争壁垒和现金流产生能力充满信心，然而，越来越多的投资者开始担心“护城河还在，城在不在”的问题。“我们认为，城始终在那里，以中国的禀赋走向发达国家不是什么意外的事情，困难只是阶段性的，越来越多的老百姓会过上好日子。市场先生的出价已经使得一些优质公司即使私有化也是非常划算的，对长期投资者是很好的机会。”张坤称。
"""

print("开始推理...")
start_time = time.time()
result = keywords_extract(text)
end_time = time.time()

print("-" * 20)
print(result)
print("-" * 20)
print(f"推理时间: {end_time - start_time:.4f}秒")