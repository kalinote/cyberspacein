# API æ¥å£å¿«é€Ÿå¼€å§‹æŒ‡å—

## ğŸ¯ å¿«é€Ÿå¼€å§‹

### 1. ç¯å¢ƒé…ç½®ï¼ˆå·²å®Œæˆï¼‰

ç¯å¢ƒé…ç½®æ–‡ä»¶å·²è‡ªåŠ¨åˆ›å»ºï¼š
- `.env.development` - å¼€å‘ç¯å¢ƒ
- `.env.production` - ç”Ÿäº§ç¯å¢ƒ

é»˜è®¤ API åœ°å€ï¼š`http://192.168.31.51:8080/api/v1`

å¦‚éœ€ä¿®æ”¹ï¼Œç¼–è¾‘å¯¹åº”çš„ `.env` æ–‡ä»¶å³å¯ã€‚

### 2. å¯åŠ¨é¡¹ç›®

```bash
pnpm dev
```

ä¿®æ”¹ç¯å¢ƒå˜é‡åï¼Œéœ€è¦é‡å¯å¼€å‘æœåŠ¡å™¨ã€‚

### 3. æŸ¥çœ‹ç¤ºä¾‹

æ‰“å¼€æµè§ˆå™¨è®¿é—® ActionResourceConfig é¡µé¢ï¼Œè¯¥é¡µé¢å·²é›†æˆåç«¯æ¥å£ï¼š
- è‡ªåŠ¨ä»åç«¯è·å–åŸºç¡€ç»„ä»¶åˆ—è¡¨
- æ”¯æŒåˆ†é¡µåŠ è½½
- æ”¯æŒæœ¬åœ°æœç´¢è¿‡æ»¤

## ğŸ“ æ–‡ä»¶è¯´æ˜

### æ ¸å¿ƒæ–‡ä»¶

```
src/
â”œâ”€â”€ utils/
â”‚   â””â”€â”€ request.js              # âœ… axios é…ç½®å’Œè¯·æ±‚å·¥å…·
â”œâ”€â”€ api/
â”‚   â””â”€â”€ action.js               # âœ… è¡ŒåŠ¨ç›¸å…³ API æ¥å£
â””â”€â”€ views/
    â””â”€â”€ action/
        â””â”€â”€ ActionResourceConfig.vue  # âœ… ç¤ºä¾‹é¡µé¢ï¼ˆå·²æ”¹é€ ï¼‰
```

## ğŸ”Œ æ¥å£é…ç½®

### å½“å‰å·²å®ç°æ¥å£

#### è·å–åŸºç¡€ç»„ä»¶åˆ—è¡¨ï¼ˆåˆ†é¡µï¼‰
```javascript
import { actionApi } from '@/api/action'

const response = await actionApi.getBaseComponents({
  page: 1,
  page_size: 10
})
```

**æ¥å£åœ°å€**: `GET /action/resource_management/base_components`

**è¯·æ±‚å‚æ•°**:
- `page`: é¡µç ï¼ˆé»˜è®¤ï¼š1ï¼‰
- `page_size`: æ¯é¡µæ•°é‡ï¼ˆé»˜è®¤ï¼š10ï¼‰

**è¿”å›æ•°æ®**:
```json
{
  "code": 0,
  "message": "success",
  "data": {
    "total": 100,
    "page": 1,
    "page_size": 10,
    "total_pages": 10,
    "items": [
      {
        "id": "xxx",
        "name": "ç»„ä»¶åç§°",
        "description": "ç»„ä»¶æè¿°",
        "status": "finished",
        "last_run_at": "2025-12-17T08:41:34.874000Z",
        "total_runs": 2,
        "average_runtime": 43
      }
    ]
  }
}
```

### å…¶ä»–é¢„ç•™æ¥å£

```javascript
// è·å–ç»„ä»¶è¯¦æƒ…
actionApi.getComponentById('component_id')

// åˆ›å»ºç»„ä»¶
actionApi.createComponent({ name: 'æ–°ç»„ä»¶', description: 'æè¿°' })

// æ›´æ–°ç»„ä»¶
actionApi.updateComponent('component_id', { name: 'æ›´æ–°åç§°' })

// åˆ é™¤ç»„ä»¶
actionApi.deleteComponent('component_id')

// è¿è¡Œç»„ä»¶
actionApi.runComponent('component_id')

// åœæ­¢ç»„ä»¶
actionApi.stopComponent('component_id')
```

## ğŸ› ï¸ ä½¿ç”¨å·¥å…·å‡½æ•°

### 1. æ™®é€šè¯·æ±‚

```javascript
import { request } from '@/utils/request'

// GET è¯·æ±‚
const response = await request.get('/your-path', { param: 'value' })

// POST è¯·æ±‚
const response = await request.post('/your-path', { data: 'value' })

// PUT è¯·æ±‚
const response = await request.put('/your-path', { data: 'value' })

// DELETE è¯·æ±‚
const response = await request.delete('/your-path')
```

### 2. åˆ†é¡µæ•°æ®è¯·æ±‚

```javascript
import { getPaginatedData } from '@/utils/request'
import { actionApi } from '@/api/action'

const result = await getPaginatedData(
  actionApi.getBaseComponents,
  { page: 1, page_size: 10 }
)

console.log(result.items)        // æ•°æ®åˆ—è¡¨
console.log(result.pagination)   // { total, page, pageSize, totalPages }
```

## ğŸ“ åœ¨æ–°é¡µé¢ä¸­ä½¿ç”¨ API

### å®Œæ•´ç¤ºä¾‹

```vue
<template>
  <div v-loading="loading">
    <!-- æ•°æ®åˆ—è¡¨ -->
    <div v-for="item in dataList" :key="item.id">
      {{ item.name }}
    </div>
    
    <!-- åˆ†é¡µ -->
    <el-pagination
      v-model:current-page="pagination.page"
      v-model:page-size="pagination.pageSize"
      :total="pagination.total"
      @current-change="handlePageChange"
      @size-change="handlePageSizeChange"
    />
  </div>
</template>

<script setup>
import { ref, onMounted } from 'vue'
import { actionApi } from '@/api/action'
import { getPaginatedData } from '@/utils/request'
import { ElMessage } from 'element-plus'

const loading = ref(false)
const dataList = ref([])
const pagination = ref({
  page: 1,
  pageSize: 10,
  total: 0,
  totalPages: 0
})

const fetchData = async () => {
  loading.value = true
  try {
    const result = await getPaginatedData(
      actionApi.getBaseComponents,
      {
        page: pagination.value.page,
        page_size: pagination.value.pageSize
      }
    )
    
    dataList.value = result.items
    pagination.value = {
      ...pagination.value,
      ...result.pagination
    }
  } catch (error) {
    console.error('è·å–æ•°æ®å¤±è´¥:', error)
    ElMessage.error('è·å–æ•°æ®å¤±è´¥')
  } finally {
    loading.value = false
  }
}

const handlePageChange = (page) => {
  pagination.value.page = page
  fetchData()
}

const handlePageSizeChange = (pageSize) => {
  pagination.value.pageSize = pageSize
  pagination.value.page = 1
  fetchData()
}

onMounted(() => {
  fetchData()
})
</script>
```

## ğŸ”§ æ·»åŠ æ–° API æ¥å£

### æ­¥éª¤ 1: åœ¨ API æ–‡ä»¶ä¸­å®šä¹‰

```javascript
// src/api/your-module.js
import { request } from '@/utils/request'

export const yourApi = {
  getList(params) {
    return request.get('/your-endpoint', params)
  },
  
  create(data) {
    return request.post('/your-endpoint', data)
  },
  
  update(id, data) {
    return request.put(`/your-endpoint/${id}`, data)
  },
  
  delete(id) {
    return request.delete(`/your-endpoint/${id}`)
  }
}
```

### æ­¥éª¤ 2: åœ¨ç»„ä»¶ä¸­ä½¿ç”¨

```vue
<script setup>
import { yourApi } from '@/api/your-module'

const handleAction = async () => {
  try {
    const response = await yourApi.getList({ page: 1 })
    console.log(response.data)
  } catch (error) {
    console.error(error)
  }
}
</script>
```

## âš ï¸ æ³¨æ„äº‹é¡¹

### 1. æ¥å£åœ°å€é…ç½®

å½“å‰é…ç½®ï¼š
- å¼€å‘ç¯å¢ƒ: `http://192.168.31.51:8080/api/v1`
- ç”Ÿäº§ç¯å¢ƒ: `http://192.168.31.51:8080/api/v1`

å¦‚æœåç«¯æ¥å£åœ°å€ä¸åŒï¼Œè¯·ä¿®æ”¹ `.env.development` æˆ– `.env.production`ã€‚

### 2. æ¥å£åœ°å€ä¸ä¸€è‡´é—®é¢˜

ç”¨æˆ·æä¾›çš„æ¥å£ç¤ºä¾‹ï¼š`http://127.0.0.1:8000/api/v1/action/resource_management/base_components`

ä½†é…ç½®çš„åŸºç¡€åœ°å€æ˜¯ï¼š`http://192.168.31.51:8080/api/v1`

**è§£å†³æ–¹æ¡ˆ**ï¼š
- å¦‚æœåç«¯è¿è¡Œåœ¨ `127.0.0.1:8000`ï¼Œè¯·ä¿®æ”¹ `.env.development` ä¸ºï¼š
  ```
  VITE_API_BASE_URL=http://127.0.0.1:8000/api/v1
  ```
- å¦‚æœåç«¯è¿è¡Œåœ¨ `192.168.31.51:8080`ï¼Œä¿æŒç°æœ‰é…ç½®ä¸å˜

### 3. è·¨åŸŸé—®é¢˜

å¦‚é‡åˆ° CORS è·¨åŸŸé”™è¯¯ï¼Œæœ‰ä¸¤ç§è§£å†³æ–¹æ¡ˆï¼š

#### æ–¹æ¡ˆ1: åç«¯é…ç½® CORSï¼ˆæ¨èï¼‰
åç«¯éœ€è¦å…è®¸å‰ç«¯åŸŸåè®¿é—®ã€‚

#### æ–¹æ¡ˆ2: å‰ç«¯é…ç½®ä»£ç†
åœ¨ `vite.config.js` ä¸­æ·»åŠ ä»£ç†é…ç½®ï¼š

```javascript
export default {
  server: {
    proxy: {
      '/api': {
        target: 'http://192.168.31.51:8080',
        changeOrigin: true
      }
    }
  }
}
```

ç„¶åä¿®æ”¹ `.env.development` ä¸ºï¼š
```
VITE_API_BASE_URL=/api/v1
```

### 4. å“åº”æ ¼å¼éªŒè¯

ç¡®ä¿åç«¯è¿”å›çš„æ•°æ®æ ¼å¼ç¬¦åˆçº¦å®šï¼š

```json
{
  "code": 0,
  "message": "success",
  "data": {
    "total": 100,
    "page": 1,
    "page_size": 10,
    "total_pages": 10,
    "items": [...]
  }
}
```

å¦‚æœå­—æ®µåä¸åŒï¼Œéœ€è¦è°ƒæ•´ `getPaginatedData` å‡½æ•°ã€‚

## ğŸ› è°ƒè¯•æŠ€å·§

### 1. æŸ¥çœ‹è¯·æ±‚è¯¦æƒ…

æ‰“å¼€æµè§ˆå™¨å¼€å‘è€…å·¥å…·ï¼ˆF12ï¼‰ï¼š
- Network æ ‡ç­¾å¯ä»¥æŸ¥çœ‹æ‰€æœ‰è¯·æ±‚
- Console æ ‡ç­¾å¯ä»¥æŸ¥çœ‹æ—¥å¿—è¾“å‡º

### 2. æµ‹è¯•æ¥å£è¿é€šæ€§

åœ¨æµè§ˆå™¨æ§åˆ¶å°ä¸­æµ‹è¯•ï¼š

```javascript
import { actionApi } from '@/api/action'

// æµ‹è¯•è·å–åˆ—è¡¨
actionApi.getBaseComponents({ page: 1, page_size: 10 })
  .then(res => console.log('æˆåŠŸ:', res))
  .catch(err => console.error('å¤±è´¥:', err))
```

### 3. æ£€æŸ¥ç¯å¢ƒå˜é‡

åœ¨ä»£ç ä¸­æ‰“å°å½“å‰é…ç½®ï¼š

```javascript
console.log('API Base URL:', import.meta.env.VITE_API_BASE_URL)
```

## ğŸ“š æ›´å¤šæ–‡æ¡£

- [API é…ç½®è¯¦ç»†è¯´æ˜](./api_configuration.md)
- [åç«¯é›†æˆæ€»ç»“](./backend_integration_summary.md)

## âœ… éªŒè¯æ¸…å•

- [ ] å¯åŠ¨å¼€å‘æœåŠ¡å™¨
- [ ] æ‰“å¼€ ActionResourceConfig é¡µé¢
- [ ] æ£€æŸ¥æµè§ˆå™¨æ§åˆ¶å°æ˜¯å¦æœ‰é”™è¯¯
- [ ] æ£€æŸ¥ Network æ ‡ç­¾æ˜¯å¦æœ‰ API è¯·æ±‚
- [ ] éªŒè¯æ•°æ®æ˜¯å¦æ­£ç¡®æ˜¾ç¤º
- [ ] æµ‹è¯•åˆ†é¡µåŠŸèƒ½æ˜¯å¦æ­£å¸¸

å¦‚æœ‰é—®é¢˜ï¼Œè¯·æŸ¥çœ‹æµè§ˆå™¨æ§åˆ¶å°çš„é”™è¯¯ä¿¡æ¯ã€‚
